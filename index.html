<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Men√∫ Semanal Saludable</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#a0522d" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: #1f1f1f;
      color: #f5f5f5;
    }
    input {
      background-color: #2c2c2c;
      color: #f5f5f5;
      border: 1px solid #555;
      padding: 10px;
      width: 100%;
      font-size: 0.9rem;
    }
    input:focus {
      outline: none;
      border-color: #a0522d;
    }
    .btn {
      background-color: #3b3b3b;
      color: #f5f5f5;
      border: 1px solid #a0522d;
      padding: 10px 20px;
      margin: 6px;
      cursor: pointer;
      border-radius: 6px;
    }
    .btn:hover {
      background-color: #a0522d;
    }
    textarea {
      background-color: #2c2c2c;
      color: #f5f5f5;
      border: 1px solid #555;
      padding: 10px;
      width: 100%;
      min-height: 140px;
      font-size: 0.9rem;
    }
    @media print {
      body {
        background: white;
        color: black;
      }
      table, .btn, select, #menu-table {
        display: none !important;
      }
      #lista-compra {
        display: block !important;
        border: none;
        background: none;
        color: black;
        font-size: 1rem;
        white-space: pre-wrap;
      }
      #titulo {
        font-size: 1.5rem;
        margin-bottom: 1rem;
        color: black;
      }
    }
  </style>
</head>
<body class="p-4">
  <h1 id="titulo" class="text-3xl font-bold mb-6 text-center">ü•ó Planificador de Men√∫ Semanal</h1>

  <div class="flex justify-center mb-4">
    <select id="tipo-menu" onchange="actualizarTitulo()" class="bg-[#2c2c2c] text-white border border-[#a0522d] p-2 rounded">
      <option value="vegan">Men√∫ Vegano</option>
      <option value="high-protein">Ganar Masa Muscular</option>
      <option value="balanced">Mantener el Peso</option>
      <option value="low-fat">Adelgazar</option>
      <option value="kid-friendly">Men√∫ Infantil</option>
    </select>
  </div>

  <div class="overflow-x-auto mb-6">
    <table class="table-auto w-full text-center border-collapse">
      <thead>
        <tr class="bg-[#2c2c2c]">
          <th class="p-2 border">D√≠a</th>
          <th class="p-2 border">Desayuno</th>
          <th class="p-2 border">Comida</th>
          <th class="p-2 border">Cena</th>
        </tr>
      </thead>
      <tbody id="menu-table"></tbody>
    </table>
  </div>

  <div class="flex flex-wrap justify-center mb-6">
    <button class="btn" onclick="generarMenu()">üé≤ Sugerir Men√∫ Saludable</button>
    <button class="btn" onclick="limpiarMenu()">üßπ Limpiar Tabla</button>
    <button class="btn" onclick="generarLista()">üõí Lista de la Compra</button>
  </div>

  <h2 class="text-xl font-semibold mb-2">üìù Lista de la Compra</h2>
  <textarea id="lista-compra" readonly></textarea>

  <script>
  const dias = ["Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes", "S√°bado", "Domingo"];
  const comidas = ["Desayuno", "Comida", "Cena"];

  const platosBase = {
    Desayuno: [
      "üçå Avena con pl√°tano", "ü•ë Tostadas con aguacate", "üçì Yogur con frutos rojos",
      "ü•¨ Smoothie verde", "üç≥ Huevos con espinacas", "üçû Pan integral con tomate",
      "üçç Fruta fresca con semillas", "ü•ú Batido de prote√≠na vegetal", "üçØ Reques√≥n con nueces"
    ],
    Comida: [
      "ü•ó Ensalada de quinoa", "üçó Pollo al horno con verduras", "üçõ Lentejas con arroz integral",
      "üêü Salm√≥n con br√≥coli", "üåÆ Tacos de tofu", "üçÖ Pisto con huevo", "ü•ò Curry de garbanzos",
      "ü•© Ternera con boniato", "üçù Pasta integral con at√∫n", "üç≥ Tortilla de claras con espinacas"
    ],
    Cena: [
      "üéÉ Crema de calabaza", "ü•í Ensalada de garbanzos", "üç≥ Tortilla de verduras",
      "üç≤ Sopa de miso", "ü•¶ Verduras al vapor", "üçÖ Gazpacho andaluz",
      "üçö Salteado de arroz y verduras", "üêü Merluza al vapor", "üçó Pechuga de pollo a la plancha"
    ]
  };

  const tabla = document.getElementById("menu-table");

  function crearTabla() {
    tabla.innerHTML = "";
    dias.forEach(dia => {
      const fila = document.createElement("tr");
      const celdaDia = document.createElement("td");
      celdaDia.className = "p-2 border font-semibold";
      celdaDia.textContent = dia;
      fila.appendChild(celdaDia);

      comidas.forEach(() => {
        const celda = document.createElement("td");
        celda.className = "p-2 border";
        const input = document.createElement("input");
        input.setAttribute("type", "text");
        celda.appendChild(input);
        fila.appendChild(celda);
      });

      tabla.appendChild(fila);
    });
  }

  function filtrarPlatos(tipoMenu) {
    const sinCarne = (plato) => !plato.includes("üêü") && !plato.includes("üçó") && !plato.includes("ü•©") && !plato.includes("üçù");
    const ricosEnProteina = (plato) => plato.includes("üçó") || plato.includes("üêü") || plato.includes("ü•©") || plato.includes("üç≥") || plato.includes("ü•ú") || plato.includes("üçØ");

    const filtrados = { Desayuno: [], Comida: [], Cena: [] };

    comidas.forEach(comida => {
      const lista = platosBase[comida];
      if (tipoMenu === "vegan") {
        filtrados[comida] = lista.filter(sinCarne);
      } else if (tipoMenu === "high-protein") {
        filtrados[comida] = lista.filter(ricosEnProteina);
      } else {
        filtrados[comida] = lista;
      }
    });

    return filtrados;
  }

  function generarMenu() {
    const tipoMenu = document.getElementById("tipo-menu").value;
    const platos = filtrarPlatos(tipoMenu);
    const filas = document.querySelectorAll("#menu-table tr");

    filas.forEach((fila, i) => {
      const usados = new Set();
      comidas.forEach((tipo, j) => {
        let sugerencia;
        let intentos = 0;
        do {
          const opciones = platos[tipo];
          sugerencia = opciones[Math.floor(Math.random() * opciones.length)];
          intentos++;
        } while (usados.has(sugerencia) && intentos < 10);
        usados.add(sugerencia);
        const input = fila.cells[j + 1].querySelector("input");
        if (input) input.value = sugerencia;
      });
    });
  }

  function limpiarMenu() {
    const filas = document.querySelectorAll("#menu-table tr");
    filas.forEach(fila => {
      comidas.forEach((_, j) => {
        const input = fila.cells[j + 1].querySelector("input");
        if (input) input.value = "";
      });
    });
    document.getElementById("lista-compra").value = "";
  }

  function generarLista() {
    const ingredientes = new Set();
    const filas = document.querySelectorAll("#menu-table tr");
    filas.forEach(fila => {
      comidas.forEach((_, j) => {
        const input = fila.cells[j + 1].querySelector("input");
        const plato = input?.value.trim();
        if (plato) ingredientes.add(plato);
      });
    });
    document.getElementById("lista-compra").value = [...ingredientes].join("\n");
  }

  function actualizarTitulo() {
    const tipoTexto = document.getElementById("tipo-menu").selectedOptions[0].textContent;
    document.getElementById("titulo").textContent = `ü•ó Planificador de Men√∫ Semanal (${tipoTexto})`;
  }

  window.addEventListener("load", () => {
    crearTabla();
    actualizarTitulo();
  });
</script>

<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("sw.js")
        .then(reg => console.log("‚úÖ Service Worker registrado:", reg.scope))
        .catch(err => console.error("‚ùå Error al registrar el Service Worker:", err));
    });
  }
</script>
</body>
</html>
